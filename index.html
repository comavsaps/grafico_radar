<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Radar de Equipe por Setores</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; background: #f4f7f9; }
        .container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 8px 30px rgba(0,0,0,0.15); width: 95%; max-width: 750px; text-align: center; }
        .instrucoes { background: #fff3cd; color: #856404; padding: 12px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; border: 1px solid #ffeeba; }
        .canvas-container { position: relative; height: 500px; margin: 20px 0; }
        .controls { display: flex; gap: 15px; justify-content: center; margin-top: 25px; }
        button { padding: 12px 25px; cursor: pointer; border: none; border-radius: 8px; font-size: 14px; font-weight: bold; transition: 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn-save { background: #007bff; color: white; }
        .btn-save:hover { background: #0056b3; transform: translateY(-1px); }
        .btn-reset { background: #6c757d; color: white; }
        .btn-reset:hover { background: #5a6268; }
        h2 { margin-bottom: 5px; color: #333; }
        p.subtitle { color: #777; margin-top: 0; margin-bottom: 25px; }
    </style>
</head>
<body>

<div class="container">
    <h2>Radar de Funcionamento da Equipe</h2>
    <p class="subtitle">Coordena칞칚o de Monitoramento e Avalia칞칚o</p>
    
    <div class="instrucoes">
        <strong>Interatividade Total:</strong> Clique em qualquer lugar da "fatia" para pint치-la at칠 o n칤vel desejado (1 a 10).
    </div>
    
    <div class="canvas-container">
        <canvas id="polarChart"></canvas>
    </div>

    <div class="controls">
        <button class="btn-save" onclick="baixarImagem()">游닌 Salvar para Apresenta칞칚o</button>
        <button class="btn-reset" onclick="resetar()">游댃 Limpar Tudo</button>
    </div>
</div>

<script>
    const ctx = document.getElementById('polarChart').getContext('2d');
    
    const labels = [
        "1. Comunica칞칚o interna",
        "2. Fluxo de trabalho",
        "3. Gest칚o de prazos",
        "4. Autonomia e clareza",
        "5. Integra칞칚o e equipe",
        "6. Bem-estar/Sustentabilidade",
        "7. Articula칞칚o institucional",
        "8. Capacidade anal칤tica"
    ];

    // Cores suaves para cada fatia (estilo profissional)
    const cores = [
        'rgba(54, 162, 235, 0.7)',  'rgba(255, 99, 132, 0.7)', 
        'rgba(75, 192, 192, 0.7)',  'rgba(255, 206, 86, 0.7)',
        'rgba(153, 102, 255, 0.7)', 'rgba(255, 159, 64, 0.7)',
        'rgba(40, 167, 69, 0.7)',   'rgba(201, 203, 207, 0.7)'
    ];

    let dados = JSON.parse(localStorage.getItem('polarData')) || [0, 0, 0, 0, 0, 0, 0, 0];

    const chart = new Chart(ctx, {
        type: 'polarArea',
        data: {
            labels: labels,
            datasets: [{
                data: dados,
                backgroundColor: cores,
                borderColor: '#fff',
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                r: {
                    min: 0,
                    max: 10,
                    ticks: { display: true, stepSize: 1, z: 10 },
                    grid: { color: '#e5e5e5' }
                }
            },
            plugins: {
                legend: { position: 'bottom', labels: { boxWidth: 12, font: { size: 11 } } }
            },
            onClick: (e) => {
                const canvasPosition = Chart.helpers.getRelativePosition(e, chart);
                
                // C치lculo de dist칙ncia para definir a nota (1-10)
                const distance = Math.sqrt(
                    Math.pow(canvasPosition.x - chart.scales.r.xCenter, 2) + 
                    Math.pow(canvasPosition.y - chart.scales.r.yCenter, 2)
                );
                const maxRadius = chart.scales.r.drawingArea;
                let nota = Math.round((distance / maxRadius) * 10);
                nota = Math.min(Math.max(nota, 0), 10);

                // C치lculo de 칙ngulo para identificar a fatia
                let angle = Math.atan2(
                    canvasPosition.y - chart.scales.r.yCenter, 
                    canvasPosition.x - chart.scales.r.xCenter
                ) + (Math.PI / 2);
                
                if (angle < 0) angle += Math.PI * 2;
                const index = Math.floor((angle / (Math.PI * 2)) * labels.length) % labels.length;

                // Atualiza o gr치fico
                chart.data.datasets[0].data[index] = nota;
                chart.update();
                localStorage.setItem('polarData', JSON.stringify(chart.data.datasets[0].data));
            }
        }
    });

    function baixarImagem() {
        const tempCanvas = document.createElement('canvas');
        tempCanvas.width = chart.width;
        tempCanvas.height = chart.height;
        const tempCtx = tempCanvas.getContext('2d');
        tempCtx.fillStyle = "white";
        tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
        tempCtx.drawImage(chart.canvas, 0, 0);
        
        const link = document.createElement('a');
        link.download = 'radar_equipe_fatias.png';
        link.href = tempCanvas.toDataURL('image/png');
        link.click();
    }

    function resetar() {
        if(confirm("Limpar todas as notas?")) {
            chart.data.datasets[0].data = [0,0,0,0,0,0,0,0];
            chart.update();
            localStorage.removeItem('polarData');
        }
    }
</script>

</body>
</html>
