<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Radar de Funcionamento da Equipe</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; background: #f4f4f4; }
        .container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); width: 80%; max-width: 800px; }
        h2, h4 { margin: 5px; text-align: center; }
        canvas { margin-top: 20px; cursor: crosshair; }
        .controls { margin-top: 20px; display: flex; gap: 10px; justify-content: center; }
        button { padding: 10px 20px; cursor: pointer; border: none; border-radius: 5px; background: #007bff; color: white; font-weight: bold; }
        button:hover { background: #0056b3; }
        button.reset { background: #dc3545; }
        .instrucoes { font-size: 0.9em; color: #666; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h2>Radar de Funcionamento da Equipe</h2>
    <h4>Coordenação de Monitoramento e Avaliação</h4>
    <p class="instrucoes">Dica: Clique em qualquer lugar das linhas do radar para definir a nota (1 a 10).</p>
    
    <canvas id="radarChart"></canvas>

    <div class="controls">
        <button onclick="baixarImagem()">Salvar como Imagem (PNG)</button>
        <button class="reset" onclick="resetarDados()">Limpar Tudo</button>
    </div>
</div>

<script>
    const ctx = document.getElementById('radarChart').getContext('2d');
    
    // Nomes das categorias (idênticos à sua imagem)
    const labels = [
        "1. Comunicação interna",
        "2. Fluxo de trabalho e processos",
        "3. Gestão de prazos",
        "4. Autonomia e clareza",
        "5. Integração e equipe",
        "6. Bem-estar e sustentabilidade",
        "7. Articulação institucional",
        "8. Capacidade analítica"
    ];

    // Carregar dados salvos ou iniciar com zeros
    let dadosSalvos = JSON.parse(localStorage.getItem('radarData')) || [0, 0, 0, 0, 0, 0, 0, 0];

    const data = {
        labels: labels,
        datasets: [{
            label: 'Avaliação da Equipe',
            data: dadosSalvos,
            fill: true,
            backgroundColor: 'rgba(54, 162, 235, 0.4)',
            borderColor: 'rgb(54, 162, 235)',
            pointBackgroundColor: 'rgb(54, 162, 235)',
            pointBorderColor: '#fff',
            pointHoverBackgroundColor: '#fff',
            pointHoverBorderColor: 'rgb(54, 162, 235)'
        }]
    };

    const config = {
        type: 'radar',
        data: data,
        options: {
            responsive: true,
            scales: {
                r: {
                    angleLines: { display: true },
                    suggestedMin: 0,
                    suggestedMax: 10,
                    ticks: { stepSize: 1 }
                }
            },
            plugins: {
                legend: { display: false }
            },
            onClick: (e, activeElements, chart) => {
                // Lógica para detectar o clique e atualizar o valor
                const canvasPosition = Chart.helpers.getRelativePosition(e, chart);
                const value = chart.scales.r.getValueForPixel(canvasPosition.x, canvasPosition.y);
                const angle = chart.scales.r.getAngleForPoint(canvasPosition.x, canvasPosition.y);
                
                // Encontrar qual fatia (índice) foi clicada baseada no ângulo
                let index = Math.round((angle - chart.scales.r.startAngle) / (Math.PI * 2 / labels.length));
                index = (index + labels.length) % labels.length;

                // Ajustar valor entre 0 e 10
                let finalValue = Math.min(Math.max(Math.round(value), 0), 10);
                
                // Atualizar gráfico e storage
                chart.data.datasets[0].data[index] = finalValue;
                chart.update();
                localStorage.setItem('radarData', JSON.stringify(chart.data.datasets[0].data));
            }
        }
    };

    const myChart = new Chart(ctx, config);

    function baixarImagem() {
        const link = document.createElement('a');
        link.download = 'radar-equipe.png';
        // Criar um canvas temporário com fundo branco (para não ficar transparente na apresentação)
        const tempCanvas = document.createElement('canvas');
        tempCanvas.width = myChart.width;
        tempCanvas.height = myChart.height;
        const tempCtx = tempCanvas.getContext('2d');
        tempCtx.fillStyle = "white";
        tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
        tempCtx.drawImage(document.getElementById('radarChart'), 0, 0);
        
        link.href = tempCanvas.toDataURL('image/png');
        link.click();
    }

    function resetarDados() {
        if(confirm("Deseja zerar o gráfico?")) {
            myChart.data.datasets[0].data = [0, 0, 0, 0, 0, 0, 0, 0];
            myChart.update();
            localStorage.removeItem('radarData');
        }
    }
</script>

</body>
</html>
